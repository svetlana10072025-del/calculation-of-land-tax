# .github/workflows/warmup.yml
name: üî• –ü—Ä–æ–≥—Ä–µ–≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤

on:
  schedule:
    - cron: '5,35 * * * *'  # –ó–∞–ø—É—Å–∫ –≤ 05 –∏ 35 –º–∏–Ω—É—Ç—ã (—á—É—Ç—å —Ä–∞–Ω—å—à–µ —Ü–µ–ª–µ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏)
  workflow_dispatch:

jobs:
  warmup:
    runs-on: ubuntu-latest
    steps:
    - name: üî• –ì–ª—É–±–æ–∫–∏–π –ø—Ä–æ–≥—Ä–µ–≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤
      run: |
        set +e
        echo "=== üî• –ì–õ–£–ë–û–ö–ò–ô –ü–†–û–ì–†–ï–í ==="
        echo "–í—Ä–µ–º—è: $(date '+%Y-%m-%d %H:%M:%S %Z')"
        echo ""
        
        CALCULATORS=(
          "https://calculation-of-land-tax-4sx2mxfrtshecl77uvz7l6.streamlit.app/"
          "https://calculation-eco-tax-xfu9rozazao4heudm3p6gz.streamlit.app/"
          "https://calculation-of-excise-bnrlk8d8pnf4wpwhwvnpfj.streamlit.app/"
          "https://calculation-of-mining-tax-jvospomyc4pgvpy8ubrrrw.streamlit.app/"
          "https://calculation-of-oil-tax-fsdt98ampwhs5pzpfzuhsy.streamlit.app/"
          "https://calculation-of-tax-bfapeep5eknsp2xxs5kfij.streamlit.app/"
        )
        
        SUCCESS=0
        TOTAL=${#CALCULATORS[@]}
        
        for url in "${CALCULATORS[@]}"; do
          DOMAIN=$(echo "$url" | cut -d'/' -f3)
          echo ""
          echo "‚îå‚îÄ üåê $DOMAIN"
          echo "‚îú‚îÄ –®–∞–≥ 1: –ü–µ—Ä–≤–∏—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–±—É–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)..."
          
          # –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å ‚Äî –±—É–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–æ–∂–∏–¥–∞–µ–º 303/403/503 ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–∏ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–∏)
          curl -L --max-redirs 5 \
            -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" \
            -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8" \
            -H "Accept-Language: en-US,en;q=0.5" \
            -H "Connection: keep-alive" \
            -H "Upgrade-Insecure-Requests: 1" \
            -m 25 \
            -s -o /dev/null \
            "$url?wakeup=$(date +%s)" >/dev/null 2>&1
          
          echo "‚îú‚îÄ ‚è≥ –ñ–¥—ë–º 20 —Å–µ–∫ (–ø–æ–ª–Ω–æ–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)..."
          sleep 20
          
          echo "‚îú‚îÄ –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–∂–¥—ë–º 200)..."
          
          # –í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø—É—â–µ–Ω–æ
          HTTP_CODE=$(curl -L --max-redirs 5 \
            -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" \
            -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8" \
            -m 15 \
            -s -o /dev/null \
            -w "%{http_code}" \
            "$url?check=$(date +%s)" 2>/dev/null || echo "ERR")
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "‚îî‚îÄ ‚úÖ –ê–ö–¢–ò–í–ï–ù (HTTP $HTTP_CODE)"
            SUCCESS=$((SUCCESS + 1))
          else
            echo "‚îî‚îÄ ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: HTTP $HTTP_CODE (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –¥–æ –∫–æ–Ω—Ü–∞ –∑–∞–ø—É—â–µ–Ω)"
          fi
          
          echo "‚îÄ‚îÄ‚îÄ"
          sleep 3
        done
        
        echo ""
        echo "=== ‚úÖ –ü–†–û–ì–†–ï–í –ó–ê–í–ï–†–®–ï–ù ==="
        echo "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: $SUCCESS/$TOTAL –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ"
        echo ""
        echo "üí° –°–æ–≤–µ—Ç: –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è 5-10 —Å–µ–∫ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É"
        
        exit 0
