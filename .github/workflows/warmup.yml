# .github/workflows/warmup.yml
name: üî• –ü—Ä–æ–≥—Ä–µ–≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤

on:
  schedule:
    - cron: '0,30 * * * *'  # –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç (48 —Ä–∞–∑/—Å—É—Ç–∫–∏)
  workflow_dispatch:

jobs:
  warmup:
    runs-on: ubuntu-latest
    steps:
    - name: üî• –ü—Ä–æ–≥—Ä–µ–≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤
      run: |
        # –û—Ç–∫–ª—é—á–∞–µ–º –∞–≤–∞—Ä–∏–π–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
        set +e
        
        echo "=== üî• –ù–ê–ß–ê–õ–û –ü–†–û–ì–†–ï–í–ê ==="
        echo "–í—Ä–µ–º—è: $(date '+%Y-%m-%d %H:%M:%S %Z')"
        echo ""
        
        CALCULATORS=(
          "https://calculation-of-land-tax-4sx2mxfrtshecl77uvz7l6.streamlit.app/"
          "https://calculation-eco-tax-xfu9rozazao4heudm3p6gz.streamlit.app/"
          "https://calculation-of-excise-bnrlk8d8pnf4wpwhwvnpfj.streamlit.app/"
          "https://calculation-of-mining-tax-jvospomyc4pgvpy8ubrrrw.streamlit.app/"
          "https://calculation-of-oil-tax-fsdt98ampwhs5pzpfzuhsy.streamlit.app/"
          "https://calculation-of-tax-bfapeep5eknsp2xxs5kfij.streamlit.app/"
        )
        
        SUCCESS=0
        TOTAL=${#CALCULATORS[@]}
        
        for url in "${CALCULATORS[@]}"; do
          DOMAIN=$(echo "$url" | cut -d'/' -f3)
          echo -n "üîÑ $DOMAIN ... "
          
          # –ö–ª—é—á–µ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
          # 1. --max-redirs 8 ‚Äî –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 47 (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã)
          # 2. -f ‚Äî –Ω–µ –≤—ã–≤–æ–¥–∏—Ç —Ç–µ–ª–æ –æ—Ç–≤–µ—Ç–∞ –ø—Ä–∏ 404/500
          # 3. 2>/dev/null || echo "ERR" ‚Äî –ø–æ–¥–∞–≤–ª—è–µ–º –æ—à–∏–±–∫–∏ stderr
          TIMESTAMP=$(date +%s)
          HTTP_CODE=$(curl -L -f --max-redirs 8 \
            -s -o /dev/null \
            -w "%{http_code}" \
            -m 20 \
            --retry 2 \
            --retry-delay 1 \
            --user-agent "Mozilla/5.0 (compatible; GitHub-Actions/1.0)" \
            "${url}?ts=${TIMESTAMP}" 2>/dev/null || echo "ERR")
          
          if [ "$HTTP_CODE" = "200" ] || [ "$HTTP_CODE" = "201" ]; then
            echo "‚úÖ $HTTP_CODE"
            SUCCESS=$((SUCCESS + 1))
          else
            echo "‚ö†Ô∏è $HTTP_CODE"
          fi
          
          sleep 1.5
        done
        
        echo ""
        echo "=== ‚úÖ –ü–†–û–ì–†–ï–í –ó–ê–í–ï–†–®–ï–ù ==="
        echo "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: $SUCCESS/$TOTAL –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤ –∞–∫—Ç–∏–≤–Ω—ã"
        
        # –í–°–ï–ì–î–ê –∑–∞–≤–µ—Ä—à–∞–µ–º —Å –∫–æ–¥–æ–º 0 ‚Äî –ø—Ä–æ–≥—Ä–µ–≤ –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–∞–¥–∞—Ç—å workflow
        exit 0
