name: üî• Warm Up Streamlit Calculators

on:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
    - cron: '*/30 * * * *'
  # –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ GitHub
  workflow_dispatch:
    inputs:
      log_level:
        description: 'Log level'
        required: true
        default: 'info'
        type: choice
        options:
        - info
        - debug

jobs:
  warmup:
    runs-on: ubuntu-latest
    steps:
    - name: üìÖ Check schedule
      run: echo "–ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–µ–≤–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤ –≤ $(date)"
    
    - name: üî• –ü—Ä–æ–≥—Ä–µ–≤ –≤—Å–µ—Ö –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤
      run: |
        # –í–∞—à–∏ 6 –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤ - –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ URL
        # –ï—Å–ª–∏ –æ–Ω–∏ –≤ –æ–¥–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –Ω–æ —Ä–∞–∑–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
        # https://username-tax-calc1.streamlit.app/
        # https://username-tax-calc2.streamlit.app/
        
        echo "–ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≥—Ä–µ–≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤..."
        
        # –ú–∞—Å—Å–∏–≤ —Å URL –≤–∞—à–∏—Ö –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤
        # –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–ò URL –ù–ê –í–ê–®–ò –†–ï–ê–õ–¨–ù–´–ï!
        CALCULATORS=(
          "https://calculation-of-land-tax-4sx2mxfrtshecl77uvz7l6.streamlit.app/"
          "https://calculation-eco-tax-xfu9rozazao4heudm3p6gz.streamlit.app/"
          "https://calculation-of-excise-bnrlk8d8pnf4wpwhwvnpfj.streamlit.app/"
          "https://calculation-of-mining-tax-jvospomyc4pgvpy8ubrrrw.streamlit.app/"
          "https://calculation-of-oil-tax-fsdt98ampwhs5pzpfzuhsy.streamlit.app/"
          "https://calculation-of-tax-bfapeep5eknsp2xxs5kfij.streamlit.app/"
        )
        
        for url in "${CALCULATORS[@]}"; do
          echo "–ü—Ä–æ–≥—Ä–µ–≤–∞–µ–º: $url"
          
          # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å —Å —Ç–∞–π–º–∞—É—Ç–æ–º
          # –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
          timestamp=$(date +%s)
          full_url="${url}?_warmup=${timestamp}"
          
          # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç (–Ω–µ —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏)
          response_code=$(curl -s -o /dev/null -w "%{http_code}" -m 120 "$full_url")
          
          if [ "$response_code" -eq 200 ] || [ "$response_code" -eq 403 ] || [ "$response_code" -lt 500 ]; then
            echo "‚úÖ –£—Å–ø–µ—Ö: HTTP $response_code"
          else
            echo "‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: HTTP $response_code"
          fi
          
          # –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å
          sleep 3
        done
        
        echo "‚úÖ –ü—Ä–æ–≥—Ä–µ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω!"
        
    - name: üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
      if: always()
      run: |
        echo "Workflow –∑–∞–≤–µ—Ä—à–µ–Ω –≤ $(date)"
        echo "–î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —à–∞–≥ '–ü—Ä–æ–≥—Ä–µ–≤ –≤—Å–µ—Ö –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤'"
